define("discourse/routes/application",["discourse/lib/computed","discourse/lib/logout","discourse/lib/show-modal","discourse/mixins/open-composer","discourse/models/category","exports"],function(e,o,t,n,i,r){"use strict";function s(e,o){return function(){this.site.get("isReadOnly")?bootbox.alert(o):this[e]()}}var a=e.setting,l=o["default"],c=t["default"],u=n["default"],d=i["default"],h=Discourse.Route.extend(u,{siteTitle:a("title"),actions:{logout:s("_handleLogout",I18n.t("read_only_mode.logout_disabled")),_handleLogout:function(){var e=this;this.currentUser&&this.currentUser.destroySession().then(function(){return l(e.siteSettings,e.keyValueStore)})},_collectTitleTokens:function(e){e.push(this.get("siteTitle")),Discourse.set("_docTitle",e.join(" - "))},willTransition:function(){var e=this.container.lookup("router:main");return Ember.run.once(e,e.trigger,"willTransition"),this._super()},showTopicEntrance:function(e){this.controllerFor("topic-entrance").send("show",e)},postWasEnqueued:function(e){var o=e.reason?"queue_reason."+e.reason+".title":"queue.approval.title";c("post-enqueued",{model:e,title:o})},composePrivateMessage:function(e,o){var t=e?e.get("username"):"",n=o?window.location.protocol+"//"+window.location.host+o.get("url"):null,i=require("discourse/models/composer")["default"];return this.controllerFor("composer").open({action:i.PRIVATE_MESSAGE,usernames:t,archetypeId:"private_message",draftKey:"new_private_message",reply:n})},error:function(e,o){var t={};e.jqXHR&&(t=e.jqXHR);var n=e.jqXHR?t:e,i=this.controllerFor("exception"),r=window.console;return r&&r.error&&r.error(n),i.setProperties({lastTransition:o,thrown:n}),this.intermediateTransitionTo("exception"),!0},showLogin:s("handleShowLogin",I18n.t("read_only_mode.login_disabled")),showCreateAccount:s("handleShowCreateAccount",I18n.t("read_only_mode.login_disabled")),showForgotPassword:function(){c("forgotPassword",{title:"forgot_password.title"})},showNotActivated:function(e){c("not-activated",{title:"log_in"}).setProperties(e)},showUploadSelector:function(e){c("uploadSelector").setProperties({toolbarEvent:e,imageUrl:null,imageLink:null})},showKeyboardShortcutsHelp:function(){c("keyboard-shortcuts-help",{title:"keyboard_shortcuts_help.title"})},closeModal:function(){this.render("hide-modal",{into:"modal",outlet:"modalBody"})},hideModal:function(){$("#discourse-modal").modal("hide")},reopenModal:function(){$("#discourse-modal").modal("show")},editCategory:function(e){var o=this;d.reloadById(e.get("id")).then(function(e){var t=o.store.createRecord("category",e.category);t.setupGroupsAndPermissions(),o.site.updateCategory(t),c("editCategory",{model:t}),o.controllerFor("editCategory").set("selectedTab","general")})},deleteSpammer:function(e){this.send("closeModal"),e.deleteAsSpammer(function(){window.location.reload()})},checkEmail:function(e){e.checkEmail()},changeBulkTemplate:function(e){var o=e.replace("modal/",""),t=this.container.lookupFactory("controller:"+o);this.render(e,{into:"modal/topic-bulk-actions",outlet:"bulkOutlet",controller:t?o:"topic-bulk-actions"})},createNewTopicViaParams:function(e,o,t,n){this.openComposerWithTopicParams(this.controllerFor("discovery/topics"),e,o,t,n)},createNewMessageViaParams:function(e,o,t){this.openComposerWithMessageParams(e,o,t)}},activate:function(){this._super(),Em.run.next(function(){h.trigger("activate")})},handleShowLogin:function(){var e=this;if(this.siteSettings.enable_sso){var o=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+o)}else this._autoLogin("login","login-modal",function(){return e.controllerFor("login").resetForm()})},handleShowCreateAccount:function(){if(this.siteSettings.enable_sso){var e=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+e)}else this._autoLogin("createAccount","create-account")},_autoLogin:function(e,o,t){var n=Em.get("Discourse.LoginMethod.all");this.siteSettings.enable_local_logins||1!==n.length?(c(e),this.controllerFor("modal").set("modalClass",o),t&&t()):this.controllerFor("login").send("externalLogin",n[0])}});RSVP.EventTarget.mixin(h),r["default"]=h});